!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports):"function"==typeof define&&define.amd?define(["exports"],o):o((e="undefined"!=typeof globalThis?globalThis:e||self)["grab-api"]={})}(this,(function(e){"use strict";function o(e,o=void 0,n="color: blue; font-size: 14px;"){void 0===o&&(o=null==window?void 0:window.location.hostname.includes("localhost")),"object"==typeof e&&(e=t(e)+"\n\n"+JSON.stringify(e,null,2)),o?console.debug((n?"%c":"")+e,n):console.log((n?"%c":"")+e,n)}function t(e){function o(e){return Array.isArray(e)?0===e.length?"Array<unknown>":`Array<${o(e[0])}>`:null===e?"null":"object"==typeof e?t(e):typeof e}if("object"!=typeof e||null===e)return o(e);let n="{ ";const r=Object.keys(e);return r.forEach(((t,i)=>{n+=`${t}: ${o(e[t])}`,i<r.length-1&&(n+=", ")})),n+=" }",n}const n=[],r={},i={};"undefined"!=typeof window?(window.grabLog=n,window.grabMockServer=r,window.grabDefaults=i):"undefined"!=typeof global&&(global.grabLog=n,global.grabMockServer=r,global.grabDefaults=i),e.grab=async function e(i,l={},a={}){var s,u,c,d,f,g,p,y,w;try{let{headers:e,method:h="GET",cache:v=!1,timeout:m=20,baseURL:D="undefined"!=typeof process&&(null==(s=null==process?void 0:process.env)?void 0:s.SERVER_API_URL)||"/api/",cancelPrevious:O=!0,cancelIfOngoing:S=!1,rateLimit:T=0,debug:j=(null==(c=null==(u=null==window?void 0:window.location)?void 0:u.hostname)?void 0:c.includes("localhost")),paginateResult:N=null,paginateKey:P="page",setDefaults:E=!1,retryOnError:L=!1,...A}={...window.grabDefaults,...a};if(null==a?void 0:a.setDefaults)return window.grabDefaults={...a,setDefaults:void 0},{};l||(l={}),i in n||(n[i]={requestData:A||{}}),n[i].requestData&&(n[i].requestData[P]=void 0);const J=JSON.stringify(n[i].requestData)==JSON.stringify(A);if(P){var b=n[i].currentPage||(null==A?void 0:A[P])||0;J||(l[N]=[],b=0),n[i].currentPage=++b,A[P]=b}else{if(v&&J){for(let e of Object.keys(n[i].responseData))l[e]=n[i].responseData[e];return l}for(let e of Object.keys(l))l[e]=void 0}if(l.isLoading=!0,T>0&&(null==(d=n[i])?void 0:d.lastFetchTime)&&(null==(f=n[i])?void 0:f.lastFetchTime)>Date.now()-1e3*T)throw new Error("Fetch rate limit exceeded");if((null==(g=n[i])?void 0:g.controller)&&J)if(O)n[i].controller.abort();else if(S)return{isLoading:!0};n[i].lastFetchTime=Date.now(),n[i].controller=new AbortController;const k={method:h,headers:{"Content-Type":"application/json",Accept:"application/json",...e},body:null,redirect:"follow",cache:v?"force-cache":"no-store",signal:O?null==(y=null==(p=n[i])?void 0:p.controller)?void 0:y.signal:AbortSignal.timeout(1e3*m)};let x="";["POST","PUT","PATCH"].includes(h)?k.body=JSON.stringify(A):x="?"+new URLSearchParams(A).toString();let R=null,q=new Date,F=null==r?void 0:r[i];if(!F||F.method!=h||F.params&&JSON.stringify(A)!=JSON.stringify(F.params)){if(R=await fetch(D+i+x,k).catch((e=>{throw new Error(e)})).then((e=>e.text())),!R.startsWith("{")){if(R.includes("error"))throw new Error(R);return R}R=JSON.parse(R)}else F.delay>0&&await new Promise((e=>setTimeout(e,F.delay))),R=F.response,"function"==typeof R&&(R=R(A));l&&(l.isLoading=void 0),j&&(o("Path:"+D+i+x+"\n"+JSON.stringify(a,null,2)+"\nTime: "+((Number(new Date)-Number(q))/1e3).toFixed(1)+"s\nResponse: "+t(R)),console.log(R));for(let e of Object.keys(R))l[e]=N==e&&(null==(w=l[e])?void 0:w.length)?[...l[e],...R[e]]:R[e];return n[i].controller=void 0,n[i].responseData=l,n[i].requestData=A||{},l}catch(o){return a.retryOnError?await e(i,l,{...a,retryOnError:!1}):(l&&(o.message.includes("signal")||(l.error=o.message),l.isLoading=!1),i in n&&(n[i].error=o.message),{error:o.message})}},e.log=o,e.printStructureJSON=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));