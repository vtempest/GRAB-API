!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GrabAPI={})}(this,(function(e){"use strict";function t(e,t=void 0,o="color: blue; font-size: 12pt;"){void 0===t&&(t="undefined"!=typeof window&&(null==window?void 0:window.location.hostname.includes("localhost"))),"object"==typeof e&&(e=i(e)+"\n\n"+JSON.stringify(e,null,2)),t?console.debug((o?"%c":"")+e,o):console.log((o?"%c":"")+e,o)}const o={reset:"[0m",yellow:"[33m",cyan:"[36m",magenta:"[35m",gray:"[90m",green:"[32m",blue:"[34m",red:"[31m",white:"[37m"};function n(e){return"string"==typeof e?o.yellow:"number"==typeof e?o.cyan:"boolean"==typeof e?o.magenta:"function"==typeof e?o.red:null===e?o.gray:Array.isArray(e)?o.blue:"object"==typeof e?o.green:o.white}function r(e){return"string"==typeof e?'""':"number"==typeof e?"number":"boolean"==typeof e?"bool":"function"==typeof e?"function":null===e?"null":Array.isArray(e)?e.length?"["+r(e[0])+"]":"[]":"object"==typeof e?"{...}":typeof e}function i(e,t=0){const l="  ".repeat(t);if("object"!=typeof e||null===e){return n(e)+r(e)+o.reset}if(Array.isArray(e)){let n=o.blue+"["+o.reset;return e.length&&(n+="\n"),e.forEach(((o,r)=>{n+=l+"  "+i(o,t+1),r<e.length-1&&(n+=","),n+="\n"})),n+=l+o.blue+"]"+o.reset,n}let a=o.green+"{"+o.reset;const s=Object.keys(e);return s.length&&(a+="\n"),s.forEach(((c,d)=>{const u=e[c],f=n(u);a+=l+"  ","object"!=typeof u||null===u||Array.isArray(u)?Array.isArray(u)?a+=f+c+o.reset+": "+i(u,t+1):a+=f+c+": "+r(u)+o.reset:a+=f+c+o.reset+": "+i(u,t+1),d<s.length-1&&(a+=","),a+="\n"})),a+=l+o.green+"}"+o.reset,a}function l(e){let t,o=document.getElementById("alert-overlay");o||(o=document.body.appendChild(document.createElement("div")),o.id="alert-overlay",o.style="position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center",o.innerHTML='<div id="alert-box" style="background:#fff;padding:1.5em 2em;border-radius:8px;box-shadow:0 2px 16px #0003;min-width:220px;max-height:80vh;position:relative;display:flex;flex-direction:column;">\n      <button id="close-alert" style="position:absolute;top:12px;right:20px;font-size:1.5em;background:none;border:none;cursor:pointer;color:black;">&times;</button>\n      <div id="alert-list" style="overflow:auto;flex:1;"></div>\n    </div>',o.addEventListener("click",(()=>o.remove())),o.querySelector("#close-alert").onclick=()=>o.remove()),t=o.querySelector("#alert-list"),t.innerHTML+=`<div style="border-bottom:1px solid #333; font-size:1.2em;margin:0.5em 0;">${e}</div>`}async function a(e,o={}){var n,r,c,d,u,f,g,p,y,b;let{headers:m,response:w={},method:h=(o.post?"POST":o.put?"PUT":o.patch?"PATCH":o.delete?"DELETE":"GET"),cache:v=!1,staleTime:S=60,timeout:T=20,baseURL:L="undefined"!=typeof process&&process.env.SERVER_API_URL||"/api/",cancelOngoingIfNew:E=!0,cancelNewIfOngoing:O=!1,rateLimit:x=0,debug:A="undefined"!=typeof window&&(null==(r=null==(n=null==window?void 0:window.location)?void 0:n.hostname)?void 0:r.includes("localhost")),infiniteScroll:j=null,setDefaults:P=!1,retryAttempts:k=0,logger:q=t,onBeforeRequest:N=null,onAfterRequest:D=null,repeatEvery:R=null,repeat:J=0,debounce:F=0,regrabOnStale:I=!1,regrabOnFocus:C=!1,regrabOnNetwork:H=!1,...U}={..."undefined"!=typeof window?null==(c=null==window?void 0:window.grab)?void 0:c.defaults:(null==(d=null==global?void 0:global.grab)?void 0:d.defaults)||{},...o};try{if(F>0)return await s((async()=>{await a(e,{...o,debounce:0})}),1e3*F);if(J>1){for(let t=0;t<J;t++)await a(e,{...o,repeat:0});return w}if(R)return setInterval((async()=>{await a(e,{...o,repeat:0,repeatEvery:null})}),1e3*R),w;if(null==o?void 0:o.setDefaults)return"undefined"!=typeof window?window.grab.defaults={...o,setDefaults:void 0}:global.grab.defaults={...o,setDefaults:void 0},{};I&&v&&setTimeout((async()=>{await a(e,{...o,cache:!1})}),1e3*S),C&&(window.addEventListener("focus",(async()=>{await a(e,{...o,cache:!1})})),document.addEventListener("visibilitychange",(async()=>{"visible"===document.visibilityState&&await a(e,{...o,cache:!1})}))),H&&window.addEventListener("online",(async()=>{"visible"===document.visibilityState&&await a(e,{...o,cache:!1})}));let n="function"==typeof w?w:null;w&&!n||(w={});var[W,$,z]=j||[];if((null==j?void 0:j.length)&&"undefined"==typeof window){let t="string"==typeof z?document.querySelector(z):z;t&&t.removeEventListener("scroll",null==window?void 0:window.scrollListener),window.scrollListener=t.addEventListener("scroll",(async({target:t})=>{localStorage.setItem("scroll",JSON.stringify([t.scrollTop,t.scrollLeft,z])),t.scrollHeight-t.scrollTop<=t.clientHeight+200&&await a(e,{...o,cache:!1,[W]:(null==l?void 0:l.currentPage)+1})}))}let r=JSON.stringify(W?{...U,[W]:void 0}:U),l=null==(u=a.log)?void 0:u.find((t=>t.request==r&&t.path==e));if(W){let e=(null==l?void 0:l.currentPage)+1||(null==U?void 0:U[W])||1;l||(w[$]=[],e=1),l&&(l.currentPage=e),U[W]=e}else{if(v&&l&&l.lastFetchTime>Date.now()-1e3*S){for(let e of Object.keys(l.res))w[e]=l.res[e];return n&&(w=n(w)),w}for(let e of Object.keys(w))w[e]=void 0}if("function"==typeof w?w=w({isLoading:!0}):"object"==typeof w&&(w.isLoading=!0),n&&(w=n(w)),x>0&&(null==l?void 0:l.lastFetchTime)&&l.lastFetchTime>Date.now()-1e3*x)throw new Error("Fetch rate limit exceeded for "+e+". Wait "+x+"s between requests.");if(null==l?void 0:l.controller)if(E)l.controller.abort();else if(O)return{isLoading:!0};a.log.unshift({path:e,request:r,lastFetchTime:Date.now(),controller:new AbortController});let c={method:h,headers:{"Content-Type":"application/json",Accept:"application/json",...m},redirect:"follow",cache:v?"force-cache":"no-store",signal:E?null==(g=null==(f=a.log[0])?void 0:f.controller)?void 0:g.signal:AbortSignal.timeout(1e3*T)},d="";["POST","PUT","PATCH"].includes(h)?c.body=U.body||JSON.stringify(U):d="?"+new URLSearchParams(U).toString(),"function"==typeof beforeRequest&&([e,w,U,c]=N(e,w,U,c)),e.startsWith("/")||L.endsWith("/")||(e="/"+e),(e.startsWith("http:")||e.startsWith("https:"))&&(L="");let b=null,P=new Date,k=null==(p=a.mock)?void 0:p[e],q=e=>new Promise((t=>setTimeout(t,1e3*e||0)));if(!k||k.params&&k.method!=h||k.params&&r!=JSON.stringify(k.params)){b=await fetch(L+e+d,c).catch((e=>{throw new Error(e)}));let t=b.headers.get("content-type");b=await(t?t.includes("application/json")?b&&b.json():t.includes("application/pdf")||t.includes("application/octet-stream")?b.blob():b.text():b.json()).catch((e=>{throw new Error("Error parsing response: "+e)}))}else await q(k.delay),b="function"==typeof k.response?k.response(U):k.response;"function"==typeof afterRequest&&([e,w,U,c]=D(e,w,U,c)),"function"==typeof w?w=w({isLoading:void 0}):"object"==typeof w&&(null==w||delete w.isLoading),null==l||delete l.controller;const M=((Number(new Date)-Number(P))/1e3).toFixed(1);if(A&&(t("Path:"+L+e+d+"\n"+JSON.stringify(o,null,2)+"\nTime: "+M+"s\nResponse: "+i(b)),console.log(b)),void 0===b)return;if("object"==typeof b)for(let e of Object.keys(b))w[e]=$==e&&(null==(y=w[e])?void 0:y.length)?[...w[e],...b[e]]:b[e];else w.data=b;return a.log.unshift({path:e,request:JSON.stringify({...U,paginateKey:void 0}),response:w,lastFetchTime:Date.now()}),n&&(w=n(w)),w}catch(M){let n="Error: "+M.message+"\nPath:"+L+e+"\n";return JSON.stringify(U),o.retryAttempts>0?await a(e,w,--o.retryAttempts):(M.message.includes("signal")||(t(n,!0,"color: red;"),A&&l(n),w.error=M.message),"function"==typeof w?w=w({isLoading:void 0,error:M.message}):null==w||delete w.isLoading,null==(b=a.log)||b.unshift({path:e,request:JSON.stringify(U),error:M.message}),"function"==typeof o.response&&(w=o.response(w)),w)}}a.instance=(e={})=>(t,o={})=>a(t,{...e,...o});const s=async(e,t)=>{let o;return async function(...n){clearTimeout(o),o=setTimeout((async()=>{clearTimeout(o),await e(...n)}),t)}};"undefined"!=typeof window?(window.grab=a,window.log=t,window.grab.log=[],window.grab.mock={},window.grab.defaults={},document.addEventListener("keydown",(e=>{if("i"===e.key&&e.ctrlKey){let e=" ";for(let t of grab.log)e+=`<div style="margin-bottom:1em; border-bottom:1px solid #ccc; padding-bottom:1em;">\n        <b>Path:</b> ${t.path}<br>\n        <b>Request:</b> ${t.request}<br>\n        <b>Response:</b> ${JSON.stringify(t.response,null,2)}<br>\n        <b>Time:</b> ${new Date(t.lastFetchTime).toLocaleString()}\n      </div>`;l(e)}})),document.addEventListener("DOMContentLoaded",(()=>{let[e,t,o]=JSON.parse(localStorage.getItem("scroll"))||[];e&&(document.querySelector(o).scrollTop=e,document.querySelector(o).scrollLeft=t)}))):"undefined"!=typeof global&&(global.grab=a,global.log=t,global.grab.log=[],global.grab.mock={},global.grab.defaults={}),e.grab=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=grab-api.umd.js.map
