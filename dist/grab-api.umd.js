!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GrabAPI={})}(this,(function(e){"use strict";function t(e,t=void 0,o="color: blue; font-size: 14px;"){void 0===t&&(t=null==window?void 0:window.location.hostname.includes("localhost")),"object"==typeof e&&(e=r(e)+"\n\n"+JSON.stringify(e,null,2)),t?console.debug((o?"%c":"")+e,o):console.log((o?"%c":"")+e,o)}const o={reset:"[0m",yellow:"[33m",cyan:"[36m",magenta:"[35m",gray:"[90m",green:"[32m",blue:"[34m",red:"[31m",white:"[37m"};function n(e){return"string"==typeof e?o.yellow:"number"==typeof e?o.cyan:"boolean"==typeof e?o.magenta:"function"==typeof e?o.red:null===e?o.gray:Array.isArray(e)?o.blue:"object"==typeof e?o.green:o.white}function l(e){return"string"==typeof e?'""':"number"==typeof e?"number":"boolean"==typeof e?"bool":"function"==typeof e?"function":null===e?"null":Array.isArray(e)?e.length?"["+l(e[0])+"]":"[]":"object"==typeof e?"{...}":typeof e}function r(e,t=0){const i="  ".repeat(t);if("object"!=typeof e||null===e){return n(e)+l(e)+o.reset}if(Array.isArray(e)){let n=o.blue+"["+o.reset;return e.length&&(n+="\n"),e.forEach(((o,l)=>{n+=i+"  "+r(o,t+1),l<e.length-1&&(n+=","),n+="\n"})),n+=i+o.blue+"]"+o.reset,n}let a=o.green+"{"+o.reset;const s=Object.keys(e);return s.length&&(a+="\n"),s.forEach(((u,c)=>{const d=e[u],f=n(d);a+=i+"  ","object"!=typeof d||null===d||Array.isArray(d)?Array.isArray(d)?a+=f+u+o.reset+": "+r(d,t+1):a+=f+u+": "+l(d)+o.reset:a+=f+u+o.reset+": "+r(d,t+1),c<s.length-1&&(a+=","),a+="\n"})),a+=i+o.green+"}"+o.reset,0===t&&console.log(a),a}async function i(e,o={}){var n,l,a,s,u,c,d,f,g,p,y;let{headers:b,response:h={},method:m="GET",cache:w=!1,timeout:v=20,baseURL:A="undefined"!=typeof process&&(null==(n=null==process?void 0:process.env)?void 0:n.SERVER_API_URL)||"/api/",cancelOngoingIfNew:O=!0,cancelNewIfOngoing:j=!1,rateLimit:S=0,debug:T=(null==(a=null==(l=null==window?void 0:window.location)?void 0:l.hostname)?void 0:a.includes("localhost")),paginateResult:N=null,paginateKey:P=null,setDefaults:R=!1,retryAttempts:E=0,logger:q=t,onBeforeRequest:D=null,...J}={...(null==(s=null==window?void 0:window.grab)?void 0:s.defaults)||(null==(u=null==global?void 0:global.grab)?void 0:u.defaults)||{},...o};try{if(null==o?void 0:o.setDefaults)return"undefined"!=typeof window?window.grab.default={...o,setDefaults:void 0}:global.grab.default={...o,setDefaults:void 0},{};h||(h={});let n=JSON.stringify(P?{...J,[P]:void 0}:J),l=null==(c=i.log)?void 0:c.find((t=>t.request==n&&t.path==e));if(P){let e=(null==l?void 0:l.currentPage)+1||(null==J?void 0:J[P])||1;l||(h[N]=[],e=1),l&&(l.currentPage=e),J[P]=e}else{if(w&&l){for(let e of Object.keys(l.res))h[e]=l.res[e];return h}for(let e of Object.keys(h))h[e]=void 0}if(h.isLoading=!0,S>0&&(null==l?void 0:l.lastFetchTime)&&l.lastFetchTime>Date.now()-1e3*S)throw new Error("Fetch rate limit exceeded for "+e+". Wait "+S+"s between requests.");if(null==l?void 0:l.controller)if(O)l.controller.abort();else if(j)return{isLoading:!0};i.log.unshift({path:e,request:n,lastFetchTime:Date.now(),controller:new AbortController});let a={method:m,headers:{"Content-Type":"application/json",Accept:"application/json",...b},redirect:"follow",cache:w?"force-cache":"no-store",signal:O?null==(f=null==(d=i.log[0])?void 0:d.controller)?void 0:f.signal:AbortSignal.timeout(1e3*v)},s="";["POST","PUT","PATCH"].includes(m)?a.body=JSON.stringify(J):s="?"+new URLSearchParams(J).toString(),"function"==typeof beforeRequest&&([e,h,J,a]=D(e,h,J,a)),e.startsWith("/")||A.endsWith("/")||(e="/"+e),(e.startsWith("http:")||e.startsWith("https:"))&&(A="");let u=null,y=new Date,R=null==(g=i.mock)?void 0:g[e];if(!R||R.params&&R.method!=m||R.params&&n!=JSON.stringify(R.params)){u=await fetch(A+e+s,a).catch((e=>{throw new Error(e)}));let t=u.headers.get("content-type");u=await(t?t.includes("application/json")?u.json():t.includes("application/pdf")||t.includes("application/octet-stream")?u.blob():u.text():u.json()).catch((e=>{throw new Error("Error parsing response: "+e)})),(null==u?void 0:u.startsWith)&&(null==u?void 0:u.startsWith("{"))&&(u=JSON.parse(u))}else await new Promise((e=>setTimeout(e,1e3*R.delay||0))),u="function"==typeof R.response?R.response(J):R.response;"function"==typeof afterRequest&&([e,h,J,a]=onAfterRequest(e,h,J,a)),delete h.isLoading,null==l||delete l.controller;const E=((Number(new Date)-Number(y))/1e3).toFixed(1);if(T&&(t("Path:"+A+e+s+"\n"+JSON.stringify(o,null,2)+"\nTime: "+E+"s\nResponse: "+r(u)),console.log(u)),void 0===u)return;for(let e of Object.keys(u))h[e]=N==e&&(null==(p=h[e])?void 0:p.length)?[...h[e],...u[e]]:u[e];return i.log.unshift({path:e,request:JSON.stringify({...J,paginateKey:void 0}),response:h,lastFetchTime:Date.now()}),h}catch(x){return t("Error: "+x.message+"\nPath:"+A+e+JSON.stringify(J),!0,"color: red;"),o.retryAttempts>0?await i(e,h,--o.retryAttempts):(x.message.includes("signal")||(h.error=x.message),delete h.isLoading,null==(y=i.log)||y.unshift({path:e,request:JSON.stringify(J),error:x.message}),h)}}r({name:"Alice",age:30,active:()=>!0,tags:["user",4,"admin"],profile:{email:"alice@example.com",verified:!1,meta:{created:"2024-01-01",score:99}}}),"undefined"!=typeof window?(window.grab=i,window.log=t,window.grab.log=[],window.grab.mock={},window.grab.default={}):"undefined"!=typeof global&&(global.grab=i,global.log=t,global.grab.log=[],global.grab.mock={},global.grab.default={}),e.default=i,e.grab=i,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
//# sourceMappingURL=grab-api.umd.js.map
