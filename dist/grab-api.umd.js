!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GrabAPI={})}(this,(function(e){"use strict";function t(e,t=void 0,o="color: blue; font-size: 13pt;"){void 0===t&&(t=null==window?void 0:window.location.hostname.includes("localhost")),"object"==typeof e&&(e=r(e)+"\n\n"+JSON.stringify(e,null,2)),t?console.debug((o?"%c":"")+e,o):console.log((o?"%c":"")+e,o)}const o={reset:"[0m",yellow:"[33m",cyan:"[36m",magenta:"[35m",gray:"[90m",green:"[32m",blue:"[34m",red:"[31m",white:"[37m"};function n(e){return"string"==typeof e?o.yellow:"number"==typeof e?o.cyan:"boolean"==typeof e?o.magenta:"function"==typeof e?o.red:null===e?o.gray:Array.isArray(e)?o.blue:"object"==typeof e?o.green:o.white}function l(e){return"string"==typeof e?'""':"number"==typeof e?"number":"boolean"==typeof e?"bool":"function"==typeof e?"function":null===e?"null":Array.isArray(e)?e.length?"["+l(e[0])+"]":"[]":"object"==typeof e?"{...}":typeof e}function r(e,t=0){const i="  ".repeat(t);if("object"!=typeof e||null===e){return n(e)+l(e)+o.reset}if(Array.isArray(e)){let n=o.blue+"["+o.reset;return e.length&&(n+="\n"),e.forEach(((o,l)=>{n+=i+"  "+r(o,t+1),l<e.length-1&&(n+=","),n+="\n"})),n+=i+o.blue+"]"+o.reset,n}let s=o.green+"{"+o.reset;const a=Object.keys(e);return a.length&&(s+="\n"),a.forEach(((d,u)=>{const c=e[d],f=n(c);s+=i+"  ","object"!=typeof c||null===c||Array.isArray(c)?Array.isArray(c)?s+=f+d+o.reset+": "+r(c,t+1):s+=f+d+": "+l(c)+o.reset:s+=f+d+o.reset+": "+r(c,t+1),u<a.length-1&&(s+=","),s+="\n"})),s+=i+o.green+"}"+o.reset,0===t&&console.log(s),s}function i(e){let t,o=document.getElementById("alert-overlay");o||(o=document.body.appendChild(document.createElement("div")),o.id="alert-overlay",o.style="position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center",o.innerHTML='<div id="alert-box" style="background:#fff;padding:1.5em 2em;border-radius:8px;box-shadow:0 2px 16px #0003;min-width:220px;max-height:80vh;position:relative;display:flex;flex-direction:column;">\n      <button id="close-alert" style="position:absolute;top:12px;right:20px;font-size:1.5em;background:none;border:none;cursor:pointer;color:black;">&times;</button>\n      <div id="alert-list" style="overflow:auto;flex:1;"></div>\n    </div>',o.addEventListener("click",(e=>{e.target===o&&o.remove()})),o.querySelector("#close-alert").onclick=()=>o.remove()),t=o.querySelector("#alert-list"),t.innerHTML+=`<div style="font-size:1.2em;margin:0.5em 0;">${e}</div>`}async function s(e,o={}){var n,l,a,d,u,c,f,g,p,b,y;let{headers:m,response:h={},method:w=(o.post?"POST":o.put?"PUT":o.patch?"PATCH":o.delete?"DELETE":"GET"),cache:v=!1,timeout:x=20,baseURL:T="undefined"!=typeof process&&(null==(n=null==process?void 0:process.env)?void 0:n.SERVER_API_URL)||"/api/",cancelOngoingIfNew:A=!0,cancelNewIfOngoing:S=!1,rateLimit:E=0,debug:O=(null==(a=null==(l=null==window?void 0:window.location)?void 0:l.hostname)?void 0:a.includes("localhost")),paginateResult:j=null,paginateKey:P=null,setDefaults:k=!1,retryAttempts:L=0,logger:N=t,onBeforeRequest:q=null,onAfterRequest:R=null,repeatEvery:D=null,repeat:J=0,debounce:F=null,...W}={...(null==(d=null==window?void 0:window.grab)?void 0:d.defaults)||(null==(u=null==global?void 0:global.grab)?void 0:u.defaults)||{},...o};try{if(J>1){for(let t=0;t<J;t++)await s(e,{...o,repeat:0});return h}if(D)return setInterval((async()=>{await s(e,{...o,repeat:0,repeatEvery:null})}),1e3*D),h;if(null==o?void 0:o.setDefaults)return"undefined"!=typeof window?window.grab.defaults={...o,setDefaults:void 0}:global.grab.defaults={...o,setDefaults:void 0},{};let n="function"==typeof h?h:null;h&&!n||(h={});let l=JSON.stringify(P?{...W,[P]:void 0}:W),i=null==(c=s.log)?void 0:c.find((t=>t.request==l&&t.path==e));if(P){let e=(null==i?void 0:i.currentPage)+1||(null==W?void 0:W[P])||1;i||(h[j]=[],e=1),i&&(i.currentPage=e),W[P]=e}else{if(v&&i){for(let e of Object.keys(i.res))h[e]=i.res[e];return n&&(h=n(h)),h}for(let e of Object.keys(h))h[e]=void 0}if(h.isLoading=!0,n&&(h=n(h)),E>0&&(null==i?void 0:i.lastFetchTime)&&i.lastFetchTime>Date.now()-1e3*E)throw new Error("Fetch rate limit exceeded for "+e+". Wait "+E+"s between requests.");if(null==i?void 0:i.controller)if(A)i.controller.abort();else if(S)return{isLoading:!0};s.log.unshift({path:e,request:l,lastFetchTime:Date.now(),controller:new AbortController});let a={method:w,headers:{"Content-Type":"application/json",Accept:"application/json",...m},redirect:"follow",cache:v?"force-cache":"no-store",signal:A?null==(g=null==(f=s.log[0])?void 0:f.controller)?void 0:g.signal:AbortSignal.timeout(1e3*x)},d="";["POST","PUT","PATCH"].includes(w)?a.body=W.body||JSON.stringify(W):d="?"+new URLSearchParams(W).toString(),"function"==typeof beforeRequest&&([e,h,W,a]=q(e,h,W,a)),e.startsWith("/")||T.endsWith("/")||(e="/"+e),(e.startsWith("http:")||e.startsWith("https:"))&&(T="");let u=null,y=new Date,k=null==(p=s.mock)?void 0:p[e],L=e=>new Promise((t=>setTimeout(t,1e3*e||0)));if(!k||k.params&&k.method!=w||k.params&&l!=JSON.stringify(k.params)){u=await fetch(T+e+d,a).catch((e=>{throw new Error(e)}));let t=u.headers.get("content-type");u=await(t?t.includes("application/json")?u.json():t.includes("application/pdf")||t.includes("application/octet-stream")?u.blob():u.text():u.json()).catch((e=>{throw new Error("Error parsing response: "+e)})),(null==u?void 0:u.startsWith)&&(null==u?void 0:u.startsWith("{"))&&(u=JSON.parse(u))}else await L(k.delay),u="function"==typeof k.response?k.response(W):k.response;"function"==typeof afterRequest&&([e,h,W,a]=R(e,h,W,a)),delete h.isLoading,null==i||delete i.controller;const N=((Number(new Date)-Number(y))/1e3).toFixed(1);if(O&&(t("Path:"+T+e+d+"\n"+JSON.stringify(o,null,2)+"\nTime: "+N+"s\nResponse: "+r(u)),console.log(u)),void 0===u)return;for(let e of Object.keys(u))h[e]=j==e&&(null==(b=h[e])?void 0:b.length)?[...h[e],...u[e]]:u[e];return s.log.unshift({path:e,request:JSON.stringify({...W,paginateKey:void 0}),response:h,lastFetchTime:Date.now()}),n&&(h=n(h)),h}catch(I){let n="Error: "+I.message+"\nPath:"+T+e+JSON.stringify(W);return O&&i(n),t(n,!0,"color: red;"),o.retryAttempts>0?await s(e,h,--o.retryAttempts):(I.message.includes("signal")||(h.error=I.message),delete h.isLoading,null==(y=s.log)||y.unshift({path:e,request:JSON.stringify(W),error:I.message}),"function"==typeof o.response&&(h=o.response(h)),h)}}s.instance=(e={})=>(t,o={})=>s(t,{...e,...o}),document.addEventListener("keydown",(e=>{if("i"===e.key&&e.ctrlKey){let e=" ";for(let t of s.log)e+=`<div style="margin-bottom:1em; border-bottom:1px solid #ccc; padding-bottom:1em;">\n        <b>Path:</b> ${t.path}<br>\n        <b>Request:</b> ${t.request}<br>\n        <b>Response:</b> ${JSON.stringify(t.response,null,2)}<br>\n        <b>Time:</b> ${new Date(t.lastFetchTime).toLocaleString()}\n      </div>`;i(e)}})),"undefined"!=typeof window?(window.grab=s,window.log=t,window.grab.log=[],window.grab.mock={},window.grab.defaults={}):"undefined"!=typeof global&&(global.grab=s,global.log=t,global.grab.log=[],global.grab.mock={},global.grab.defaults={}),e.grab=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=grab-api.umd.js.map
