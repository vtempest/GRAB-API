!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports):"function"==typeof define&&define.amd?define(["exports"],o):o((e="undefined"!=typeof globalThis?globalThis:e||self)["grab-api"]={})}(this,(function(e){"use strict";async function o(e,r={},i={}){var s,a,d,u,c,f,g,p,b;let{headers:w,method:h="GET",cache:y=!1,timeout:v=20,baseURL:m="undefined"!=typeof process&&(null==(s=null==process?void 0:process.env)?void 0:s.SERVER_API_URL)||"/api/",cancelOngoingIfNew:O=!0,cancelNewIfOngoing:S=!1,rateLimit:j=0,debug:N=(null==(d=null==(a=null==window?void 0:window.location)?void 0:a.hostname)?void 0:d.includes("localhost")),paginateResult:T=null,paginateKey:E=null,setDefaults:P=!1,retryOnError:J=!1,...L}={...(null==(u=null==window?void 0:window.grab)?void 0:u.defaults)||(null==(c=null==global?void 0:global.grab)?void 0:c.defaults)||{},...i};try{if(null==i?void 0:i.setDefaults)return window.grab.defaults={...i,setDefaults:void 0},{};r||(r={});let s=JSON.stringify({...L,paginateKey:void 0}),a=null==l?void 0:l.find((o=>o.request==s&&o.path==e));const d=(null==a?void 0:a.request)==s;if(E){let e=(null==a?void 0:a.currentPage)+1||(null==L?void 0:L[E])||1;d||(r[T]=[],e=1),a&&(a.currentPage=e),L[E]=e}else{if(y&&d){for(let e of Object.keys(a.res))r[e]=a.res[e];return r}for(let e of Object.keys(r))r[e]=void 0}if(r.isLoading=!0,j>0&&(null==a?void 0:a.lastFetchTime)&&a.lastFetchTime>Date.now()-1e3*j)throw new Error("Fetch rate limit exceeded");if((null==a?void 0:a.controller)&&d)if(O)a.controller.abort();else if(S)return{isLoading:!0};l.unshift({path:e,request:s,lastFetchTime:Date.now(),controller:new AbortController});const u={method:h,headers:{"Content-Type":"application/json",Accept:"application/json",...w},body:null,redirect:"follow",cache:y?"force-cache":"no-store",signal:O?null==(g=null==(f=l[0])?void 0:f.controller)?void 0:g.signal:AbortSignal.timeout(1e3*v)};let c="";["POST","PUT","PATCH"].includes(h)?u.body=JSON.stringify(L):c="?"+new URLSearchParams(L).toString();let P=null,J=new Date,D=null==(p=o.server)?void 0:p[e];if(!D||D.params&&D.method!=h||D.params&&s!=JSON.stringify(D.params)){P=await fetch((!e.startsWith("http")&&m)+e+c,u).catch((e=>{throw new Error(e)}));let o=P.headers.get("content-type");P=await(o?o.includes("application/json")?P.json():o.includes("application/pdf")||o.includes("application/octet-stream")?P.blob():P.text():P.json()).catch((e=>{throw new Error("Error parsing response: "+e)})),(null==P?void 0:P.startsWith)&&(null==P?void 0:P.startsWith("{"))&&(P=JSON.parse(P))}else await new Promise((e=>setTimeout(e,1e3*D.delay||0))),P="function"==typeof D.response?D.response(L):D.response;delete r.isLoading;const x=((Number(new Date)-Number(J))/1e3).toFixed(1);if(N&&(t("Path:"+m+e+c+"\n"+JSON.stringify(i,null,2)+"\nTime: "+x+"s\nResponse: "+n(P)),console.log(P)),void 0===P)return;for(let e of Object.keys(P))r[e]=T==e&&(null==(b=r[e])?void 0:b.length)?[...r[e],...P[e]]:P[e];return l.unshift({path:e,request:JSON.stringify({...L,paginateKey:void 0}),response:r,lastFetchTime:Date.now()}),r}catch(D){return t("Error: "+D.message+"\nPath:"+m+e+JSON.stringify(L),!0,"color: red;"),i.retryOnError?await o(e,r,{...i,retryOnError:!1}):(D.message.includes("signal")||(r.error=D.message),delete r.isLoading,null==l||l.unshift({path:e,request:JSON.stringify(L),error:D.message}),r)}}function t(e,o=void 0,t="color: blue; font-size: 14px;"){void 0===o&&(o=null==window?void 0:window.location.hostname.includes("localhost")),"object"==typeof e&&(e=n(e)+"\n\n"+JSON.stringify(e,null,2)),o?console.debug((t?"%c":"")+e,t):console.log((t?"%c":"")+e,t)}function n(e){function o(e){return Array.isArray(e)?"["+o(e[0])+"]":null===e?"null":"object"==typeof e?n(e):"string"==typeof e?'""':"boolean"==typeof e?"bool":typeof e}if("object"!=typeof e||null===e)return o(e);let t="{";const l=Object.keys(e);return l.forEach(((n,r)=>{t+=`${n}: ${o(e[n])}`,r<l.length-1&&(t+=", ")})),t+="}",t}const l=[],r={},i={};"undefined"!=typeof window?(window.grab=o,window.log=t,window.grab.log=l,window.grab.server=r,window.grab.defaults=i):"undefined"!=typeof global&&(global.grab.log=l,global.grab.server=o.server,global.grab.defaults=o.defaults,global.grab=o,global.log=t),e.default=o,e.grab=o,e.log=t,e.printStructureJSON=n,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
//# sourceMappingURL=grab-api.umd.js.map
