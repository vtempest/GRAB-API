"use strict";function e(e,t=void 0,o="color: blue; font-size: 13pt;"){void 0===t&&(t=null==window?void 0:window.location.hostname.includes("localhost")),"object"==typeof e&&(e=r(e)+"\n\n"+JSON.stringify(e,null,2)),t?console.debug((o?"%c":"")+e,o):console.log((o?"%c":"")+e,o)}Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t={reset:"[0m",yellow:"[33m",cyan:"[36m",magenta:"[35m",gray:"[90m",green:"[32m",blue:"[34m",red:"[31m",white:"[37m"};function o(e){return"string"==typeof e?t.yellow:"number"==typeof e?t.cyan:"boolean"==typeof e?t.magenta:"function"==typeof e?t.red:null===e?t.gray:Array.isArray(e)?t.blue:"object"==typeof e?t.green:t.white}function n(e){return"string"==typeof e?'""':"number"==typeof e?"number":"boolean"==typeof e?"bool":"function"==typeof e?"function":null===e?"null":Array.isArray(e)?e.length?"["+n(e[0])+"]":"[]":"object"==typeof e?"{...}":typeof e}function r(e,l=0){const i="  ".repeat(l);if("object"!=typeof e||null===e){return o(e)+n(e)+t.reset}if(Array.isArray(e)){let o=t.blue+"["+t.reset;return e.length&&(o+="\n"),e.forEach(((t,n)=>{o+=i+"  "+r(t,l+1),n<e.length-1&&(o+=","),o+="\n"})),o+=i+t.blue+"]"+t.reset,o}let a=t.green+"{"+t.reset;const s=Object.keys(e);return s.length&&(a+="\n"),s.forEach(((c,d)=>{const u=e[c],f=o(u);a+=i+"  ","object"!=typeof u||null===u||Array.isArray(u)?Array.isArray(u)?a+=f+c+t.reset+": "+r(u,l+1):a+=f+c+": "+n(u)+t.reset:a+=f+c+t.reset+": "+r(u,l+1),d<s.length-1&&(a+=","),a+="\n"})),a+=i+t.green+"}"+t.reset,0===l&&console.log(a),a}async function l(t,o={}){var n,a,s,c,d,u,f,g,p,y;let{headers:b,response:m={},method:w=(o.post?"POST":o.put?"PUT":o.patch?"PATCH":o.delete?"DELETE":"GET"),cache:h=!1,staleTime:v=60,timeout:S=20,baseURL:T="undefined"!=typeof process&&process.env.SERVER_API_URL||"/api/",cancelOngoingIfNew:E=!0,cancelNewIfOngoing:L=!1,rateLimit:O=0,debug:x="undefined"!=typeof window&&(null==(a=null==(n=null==window?void 0:window.location)?void 0:n.hostname)?void 0:a.includes("localhost")),infiniteScroll:A=null,setDefaults:j=!1,retryAttempts:N=0,logger:P=e,onBeforeRequest:k=null,onAfterRequest:q=null,repeatEvery:D=null,repeat:J=0,debounce:R=0,regrabOnStale:F=!1,regrabOnFocus:I=!1,regrabOnNetwork:C=!1,...H}={...(null==(s=null==window?void 0:window.grab)?void 0:s.defaults)||(null==(c=null==global?void 0:global.grab)?void 0:c.defaults)||{},...o};try{if(R>0)return await i((async()=>{await l(t,{...o,debounce:0})}),1e3*R);if(J>1){for(let e=0;e<J;e++)await l(t,{...o,repeat:0});return m}if(D)return setInterval((async()=>{await l(t,{...o,repeat:0,repeatEvery:null})}),1e3*D),m;if(null==o?void 0:o.setDefaults)return"undefined"!=typeof window?window.grab.defaults={...o,setDefaults:void 0}:global.grab.defaults={...o,setDefaults:void 0},{};F&&setTimeout((async()=>{await l(t,{...o,cache:!1})}),1e3*v),I&&(window.addEventListener("focus",(async()=>{await l(t,{...o,cache:!1})})),document.addEventListener("visibilitychange",(async()=>{"visible"===document.visibilityState&&await l(t,{...o,cache:!1})}))),C&&window.addEventListener("online",(async()=>{"visible"===document.visibilityState&&await l(t,{...o,cache:!1})}));let n="function"==typeof m?m:null;m&&!n||(m={});var[U,W,z]=A||[];if((null==A?void 0:A.length)&&"undefined"==typeof window){let e="string"==typeof z?document.querySelector(z):z;e.removeEventListener("scroll",null==window?void 0:window.scrollListener),window.scrollListener=e.addEventListener("scroll",(async({target:e})=>{localStorage.setItem("scroll",JSON.stringify([e.scrollTop,e.scrollLeft,z])),e.scrollHeight-e.scrollTop<=e.clientHeight+200&&await l(t,{...o,cache:!1,[U]:(null==s?void 0:s.currentPage)+1})}))}let a=JSON.stringify(U?{...H,[U]:void 0}:H),s=null==(d=l.log)?void 0:d.find((e=>e.request==a&&e.path==t));if(U){let e=(null==s?void 0:s.currentPage)+1||(null==H?void 0:H[U])||1;s||(m[W]=[],e=1),s&&(s.currentPage=e),H[U]=e}else{if(h&&s&&s.lastFetchTime>Date.now()-1e3*v){for(let e of Object.keys(s.res))m[e]=s.res[e];return n&&(m=n(m)),m}for(let e of Object.keys(m))m[e]=void 0}if(m.isLoading=!0,n&&(m=n(m)),O>0&&(null==s?void 0:s.lastFetchTime)&&s.lastFetchTime>Date.now()-1e3*O)throw new Error("Fetch rate limit exceeded for "+t+". Wait "+O+"s between requests.");if(null==s?void 0:s.controller)if(E)s.controller.abort();else if(L)return{isLoading:!0};l.log.unshift({path:t,request:a,lastFetchTime:Date.now(),controller:new AbortController});let c={method:w,headers:{"Content-Type":"application/json",Accept:"application/json",...b},redirect:"follow",cache:h?"force-cache":"no-store",signal:E?null==(f=null==(u=l.log[0])?void 0:u.controller)?void 0:f.signal:AbortSignal.timeout(1e3*S)},y="";["POST","PUT","PATCH"].includes(w)?c.body=H.body||JSON.stringify(H):y="?"+new URLSearchParams(H).toString(),"function"==typeof beforeRequest&&([t,m,H,c]=k(t,m,H,c)),t.startsWith("/")||T.endsWith("/")||(t="/"+t),(t.startsWith("http:")||t.startsWith("https:"))&&(T="");let j=null,N=new Date,P=null==(g=l.mock)?void 0:g[t],M=e=>new Promise((t=>setTimeout(t,1e3*e||0)));if(!P||P.params&&P.method!=w||P.params&&a!=JSON.stringify(P.params)){j=await fetch(T+t+y,c).catch((e=>{throw new Error(e)}));let e=j.headers.get("content-type");j=await(e?e.includes("application/json")?j&&j.json():e.includes("application/pdf")||e.includes("application/octet-stream")?j.blob():j.text():j.json()).catch((e=>{throw new Error("Error parsing response: "+e)}))}else await M(P.delay),j="function"==typeof P.response?P.response(H):P.response;"function"==typeof afterRequest&&([t,m,H,c]=q(t,m,H,c)),delete m.isLoading,null==s||delete s.controller;const B=((Number(new Date)-Number(N))/1e3).toFixed(1);if(x&&(e("Path:"+T+t+y+"\n"+JSON.stringify(o,null,2)+"\nTime: "+B+"s\nResponse: "+r(j)),console.log(j)),void 0===j)return;for(let e of Object.keys(j))m[e]=W==e&&(null==(p=m[e])?void 0:p.length)?[...m[e],...j[e]]:j[e];return l.log.unshift({path:t,request:JSON.stringify({...H,paginateKey:void 0}),response:m,lastFetchTime:Date.now()}),n&&(m=n(m)),m}catch(M){let n="Error: "+M.message+"\nPath:"+T+t+"\n";return JSON.stringify(H),o.retryAttempts>0?await l(t,m,--o.retryAttempts):(M.message.includes("signal")||(e(n,!0,"color: red;"),x&&function(e){let t,o=document.getElementById("alert-overlay");o||(o=document.body.appendChild(document.createElement("div")),o.id="alert-overlay",o.style="position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center",o.innerHTML='<div id="alert-box" style="background:#fff;padding:1.5em 2em;border-radius:8px;box-shadow:0 2px 16px #0003;min-width:220px;max-height:80vh;position:relative;display:flex;flex-direction:column;">\n      <button id="close-alert" style="position:absolute;top:12px;right:20px;font-size:1.5em;background:none;border:none;cursor:pointer;color:black;">&times;</button>\n      <div id="alert-list" style="overflow:auto;flex:1;"></div>\n    </div>',o.addEventListener("click",(()=>o.remove())),o.querySelector("#close-alert").onclick=()=>o.remove()),t=o.querySelector("#alert-list"),t.innerHTML+=`<div style="border-bottom:1px solid #333; font-size:1.2em;margin:0.5em 0;">${e}</div>`}(n),m.error=M.message),delete m.isLoading,null==(y=l.log)||y.unshift({path:t,request:JSON.stringify(H),error:M.message}),"function"==typeof o.response&&(m=o.response(m)),m)}}const i=async(e,t)=>{let o;return async function(...n){clearTimeout(o),o=setTimeout((async()=>{clearTimeout(o),await e(...n)}),t)}};"undefined"!=typeof window?(window.grab=l,window.log=e,window.grab.log=[],window.grab.mock={},window.grab.defaults={},document.addEventListener("DOMContentLoaded",(()=>{let[e,t,o]=JSON.parse(localStorage.getItem("scroll"))||[];e&&(document.querySelector(o).scrollTop=e,document.querySelector(o).scrollLeft=t)}))):"undefined"!=typeof global&&(global.grab=l,global.log=e,global.grab.log=[],global.grab.mock={},global.grab.defaults={}),exports.grab=l;
//# sourceMappingURL=grab-api.cjs.js.map
