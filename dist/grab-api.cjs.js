"use strict";function e(e,t=void 0,o="color: blue; font-size: 12pt;"){void 0===t&&(t="undefined"!=typeof window&&(null==window?void 0:window.location.hostname.includes("localhost"))),"object"==typeof e&&(e=r(e)+"\n\n"+JSON.stringify(e,null,2)),t?console.debug((o?"%c":"")+e,o):console.log((o?"%c":"")+e,o)}Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t={reset:"[0m",yellow:"[33m",cyan:"[36m",magenta:"[35m",gray:"[90m",green:"[32m",blue:"[34m",red:"[31m",white:"[37m"};function o(e){return"string"==typeof e?t.yellow:"number"==typeof e?t.cyan:"boolean"==typeof e?t.magenta:"function"==typeof e?t.red:null===e?t.gray:Array.isArray(e)?t.blue:"object"==typeof e?t.green:t.white}function n(e){return"string"==typeof e?'""':"number"==typeof e?"number":"boolean"==typeof e?"bool":"function"==typeof e?"function":null===e?"null":Array.isArray(e)?e.length?"["+n(e[0])+"]":"[]":"object"==typeof e?"{...}":typeof e}function r(e,l=0){const i="  ".repeat(l);if("object"!=typeof e||null===e){return o(e)+n(e)+t.reset}if(Array.isArray(e)){let o=t.blue+"["+t.reset;return e.length&&(o+="\n"),e.forEach(((t,n)=>{o+=i+"  "+r(t,l+1),n<e.length-1&&(o+=","),o+="\n"})),o+=i+t.blue+"]"+t.reset,o}let a=t.green+"{"+t.reset;const s=Object.keys(e);return s.length&&(a+="\n"),s.forEach(((c,d)=>{const u=e[c],f=o(u);a+=i+"  ","object"!=typeof u||null===u||Array.isArray(u)?Array.isArray(u)?a+=f+c+t.reset+": "+r(u,l+1):a+=f+c+": "+n(u)+t.reset:a+=f+c+t.reset+": "+r(u,l+1),d<s.length-1&&(a+=","),a+="\n"})),a+=i+t.green+"}"+t.reset,a}function l(e){let t,o=document.getElementById("alert-overlay");o||(o=document.body.appendChild(document.createElement("div")),o.id="alert-overlay",o.setAttribute("style","position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center"),o.innerHTML='<div id="alert-box" style="background:#fff;padding:1.5em 2em;border-radius:8px;box-shadow:0 2px 16px #0003;min-width:220px;max-height:80vh;position:relative;display:flex;flex-direction:column;">\n      <button id="close-alert" style="position:absolute;top:12px;right:20px;font-size:1.5em;background:none;border:none;cursor:pointer;color:black;">&times;</button>\n      <div id="alert-list" style="overflow:auto;flex:1;"></div>\n    </div>',o.addEventListener("click",(e=>e.target==o&&o.remove())),document.getElementById("close-alert").onclick=()=>o.remove()),t=o.querySelector("#alert-list"),t.innerHTML+=`<div style="border-bottom:1px solid #333; font-size:1.2em;margin:0.5em 0;">${e}</div>`}async function i(t,o){var n,c,d,u,f,g,p,y,b;let{headers:m,response:w={},method:h=(o.post?"POST":o.put?"PUT":o.patch?"PATCH":"GET"),cache:v=!1,cacheForTime:T=60,timeout:S=30,baseURL:x="undefined"!=typeof process&&process.env.SERVER_API_URL||"/api/",cancelOngoingIfNew:L=!1,cancelNewIfOngoing:O=!1,rateLimit:E=0,debug:A=!1,infiniteScroll:j=null,setDefaults:P=!1,retryAttempts:k=0,logger:N=e,onBeforeRequest:q=null,onAfterRequest:D=null,onError:J=null,onStream:R=null,repeatEvery:F=null,repeat:I=0,debounce:_=0,regrabOnStale:H=!1,regrabOnFocus:$=!1,regrabOnNetwork:C=!1,post:M=!1,put:W=!1,patch:z=!1,body:U=null,...B}={..."undefined"!=typeof window?null==(n=null==window?void 0:window.grab)?void 0:n.defaults:(null==(c=null==global?void 0:global.grab)?void 0:c.defaults)||{},...o};try{if(_>0)return await a((async()=>{await i(t,{...o,debounce:0})}),1e3*_);if(I>1){for(let e=0;e<I;e++)await i(t,{...o,repeat:0});return w}if(F)return setInterval((async()=>{await i(t,{...o,repeat:0,repeatEvery:null})}),1e3*F),w;if(null==o?void 0:o.setDefaults)return"undefined"!=typeof window?window.grab.defaults={...o,setDefaults:void 0}:void 0!==(global||globalThis).grab&&((global||globalThis).grab.defaults={...o,setDefaults:void 0}),{};H&&v&&setTimeout((async()=>{await i(t,{...o,cache:!1})}),1e3*T),$&&(window.addEventListener("focus",(async()=>{await i(t,{...o,cache:!1})})),document.addEventListener("visibilitychange",(async()=>{"visible"===document.visibilityState&&await i(t,{...o,cache:!1})}))),C&&window.addEventListener("online",(async()=>{"visible"===document.visibilityState&&await i(t,{...o,cache:!1})}));let n="function"==typeof w?w:null;w&&!n||(w={});var[K,G,V]=j||[];if((null==j?void 0:j.length)&&"undefined"==typeof window){let e="string"==typeof V?document.querySelector(V):V;e&&e.removeEventListener("scroll",null==(d=window??globalThis)?void 0:d.scrollListener),(window??globalThis).scrollListener=e.addEventListener("scroll",(async({target:e})=>{const n=e;localStorage.setItem("scroll",JSON.stringify([n.scrollTop,n.scrollLeft,V])),n.scrollHeight-n.scrollTop<=n.clientHeight+200&&await i(t,{...o,cache:!1,[K]:(null==c?void 0:c.currentPage)+1})}))}let l=JSON.stringify(K?{...B,[K]:void 0}:B),c=null==(u=null==i?void 0:i.log)?void 0:u.find((e=>e.request==l&&e.path==t));if(K){let e=(null==c?void 0:c.currentPage)+1||(null==B?void 0:B[K])||1;c||(w[G]=[],e=1),c&&(c.currentPage=e),B[K]=e}else{for(let e of Object.keys(w))w[e]=void 0;if(v&&(!T||(null==c?void 0:c.lastFetchTime)>Date.now()-1e3*T)){for(let e of Object.keys(c.res))w[e]=c.res[e];n&&(w=n(w))}}if(n?n({isLoading:!0}):"object"==typeof w&&(w.isLoading=!0),n&&(w=n(w)),E>0&&(null==c?void 0:c.lastFetchTime)&&c.lastFetchTime>Date.now()-1e3*E)throw new Error("Fetch rate limit exceeded for "+t+". Wait "+E+"s between requests.");if(null==c?void 0:c.controller)if(L)c.controller.abort();else if(O)return{isLoading:!0};i.log.unshift({path:t,request:l,lastFetchTime:Date.now(),controller:new AbortController});let b={method:h,headers:{"Content-Type":"application/json",Accept:"application/json",...m},body:B.body,redirect:"follow",cache:v?"force-cache":"no-store",signal:L?null==(g=null==(f=i.log[0])?void 0:f.controller)?void 0:g.signal:AbortSignal.timeout(1e3*S)},P="";["POST","PUT","PATCH"].includes(h)?b.body=B.body||JSON.stringify(B):P="?"+new URLSearchParams(B).toString(),"function"==typeof q&&([t,w,B,b]=q(t,w,B,b)),t.startsWith("/")||x.endsWith("/")||(t="/"+t),(t.startsWith("http:")||t.startsWith("https:"))&&(x="");let k=null,N=new Date,J=null==(p=i.mock)?void 0:p[t],M=e=>new Promise((t=>setTimeout(t,1e3*e||0)));if(!J||J.params&&J.method!=h||J.params&&l!=JSON.stringify(J.params)){if(k=await fetch(x+t+P,b).catch((e=>{throw new Error(e)})),!k.ok)throw new Error(`HTTP error: ${k.status} ${k.statusText}`);if(R){const{Readable:e}=await Promise.resolve().then((()=>s)),t=e.fromWeb(w.body);return await new Promise(((e,o)=>{t.pipe(R).on("finish",e).on("error",o)}))}let e=k.headers.get("content-type");k=await(e?e.includes("application/json")?k&&k.json():e.includes("application/pdf")||e.includes("application/octet-stream")?k.blob():k.text():k.json()).catch((e=>{throw new Error("Error parsing response: "+e)}))}else await M(J.delay),k="function"==typeof J.response?J.response(B):J.response;"function"==typeof D&&([t,w,B,b]=D(t,w,B,b)),n?n({isLoading:void 0}):"object"==typeof w&&(null==w||delete w.isLoading),null==c||delete c.controller;const W=((Number(new Date)-Number(N))/1e3).toFixed(1);if(A&&(e("Path:"+x+t+P+"\n"+JSON.stringify(o,null,2)+"\nTime: "+W+"s\nResponse: "+r(k)),console.log(k)),void 0===k)return;if("object"==typeof k)for(let e of Object.keys(k))w[e]=G==e&&(null==(y=w[e])?void 0:y.length)?[...w[e],...k[e]]:k[e];else n?n({data:k}):"object"==typeof w&&(w.data=k);return i.log.unshift({path:t,request:JSON.stringify({...B,paginateKey:void 0}),response:w,lastFetchTime:Date.now()}),n&&(w=n(w)),w}catch(Q){let n="Error: "+Q.message+"\nPath:"+x+t+"\n";return JSON.stringify(B),"function"==typeof J&&J(Q.message,x+t,B),o.retryAttempts>0?await i(t,{...o,retryAttempts:--o.retryAttempts}):(Q.message.includes("signal")||(e(n,!0,"color: red;"),A&&l(n),w.error=Q.message),"function"==typeof w?w=w({isLoading:void 0,error:Q.message}):null==w||delete w.isLoading,null==(b=i.log)||b.unshift({path:t,request:JSON.stringify(B),error:Q.message}),"function"==typeof o.response&&(w=o.response(w)),w)}}i.instance=(e={})=>(t,o={})=>i(t,{...e,...o});const a=async(e,t)=>{let o;return async function(...n){clearTimeout(o),o=setTimeout((async()=>{clearTimeout(o),await e(...n)}),t)}};"undefined"!=typeof window?(window.log=e,window.grab=i.instance(),window.grab.log=[],window.grab.mock={},window.grab.defaults={},document.addEventListener("keydown",(e=>{if("i"===e.key&&e.ctrlKey){let e=" ";for(let t of grab.log)e+=`<div style="margin-bottom:1em; border-bottom:1px solid #ccc; padding-bottom:1em;">\n          <b>Path:</b> ${t.path}<br>\n          <b>Request:</b> ${t.request}<br>\n          <b>Response:</b> ${JSON.stringify(t.response,null,2)}<br>\n          <b>Time:</b> ${new Date(t.lastFetchTime).toLocaleString()}\n        </div>`;l(e)}})),document.addEventListener("DOMContentLoaded",(()=>{let[e,t,o]=JSON.parse(localStorage.getItem("scroll"))||[];e&&(document.querySelector(o).scrollTop=e,document.querySelector(o).scrollLeft=t)}))):"undefined"!=typeof global?(i.log=[],i.mock={},i.defaults={},global.log=e,global.grab=i.instance()):"undefined"!=typeof globalThis&&(i.log=[],i.mock={},i.defaults={},globalThis.log=e,globalThis.grab=i.instance());const s=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));exports.default=i,exports.grab=i,exports.log=e,exports.printStructureJSON=r,exports.showAlert=l;
//# sourceMappingURL=grab-api.cjs.js.map
