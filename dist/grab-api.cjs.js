"use strict";function e(e,t=void 0,o="color: blue; font-size: 14px;"){void 0===t&&(t=null==window?void 0:window.location.hostname.includes("localhost")),"object"==typeof e&&(e=l(e)+"\n\n"+JSON.stringify(e,null,2)),t?console.debug((o?"%c":"")+e,o):console.log((o?"%c":"")+e,o)}Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t={reset:"[0m",yellow:"[33m",cyan:"[36m",magenta:"[35m",gray:"[90m",green:"[32m",blue:"[34m",red:"[31m",white:"[37m"};function o(e){return"string"==typeof e?t.yellow:"number"==typeof e?t.cyan:"boolean"==typeof e?t.magenta:"function"==typeof e?t.red:null===e?t.gray:Array.isArray(e)?t.blue:"object"==typeof e?t.green:t.white}function n(e){return"string"==typeof e?'""':"number"==typeof e?"number":"boolean"==typeof e?"bool":"function"==typeof e?"function":null===e?"null":Array.isArray(e)?e.length?"["+n(e[0])+"]":"[]":"object"==typeof e?"{...}":typeof e}function l(e,r=0){const i="  ".repeat(r);if("object"!=typeof e||null===e){return o(e)+n(e)+t.reset}if(Array.isArray(e)){let o=t.blue+"["+t.reset;return e.length&&(o+="\n"),e.forEach(((t,n)=>{o+=i+"  "+l(t,r+1),n<e.length-1&&(o+=","),o+="\n"})),o+=i+t.blue+"]"+t.reset,o}let a=t.green+"{"+t.reset;const s=Object.keys(e);return s.length&&(a+="\n"),s.forEach(((u,d)=>{const c=e[u],f=o(c);a+=i+"  ","object"!=typeof c||null===c||Array.isArray(c)?Array.isArray(c)?a+=f+u+t.reset+": "+l(c,r+1):a+=f+u+": "+n(c)+t.reset:a+=f+u+t.reset+": "+l(c,r+1),d<s.length-1&&(a+=","),a+="\n"})),a+=i+t.green+"}"+t.reset,0===r&&console.log(a),a}async function r(t,o={}){var n,i,a,s,u,d,c,f,g,p,y;let{headers:b,response:m={},method:h=(o.post?"POST":o.put?"PUT":o.patch?"PATCH":o.delete?"DELETE":"GET"),cache:w=!1,timeout:v=20,baseURL:x="undefined"!=typeof process&&(null==(n=null==process?void 0:process.env)?void 0:n.SERVER_API_URL)||"/api/",cancelOngoingIfNew:A=!0,cancelNewIfOngoing:S=!1,rateLimit:E=0,debug:O=(null==(a=null==(i=null==window?void 0:window.location)?void 0:i.hostname)?void 0:a.includes("localhost")),paginateResult:T=null,paginateKey:j=null,setDefaults:P=!1,retryAttempts:k=0,logger:N=e,onBeforeRequest:L=null,onAfterRequest:q=null,repeatEvery:R=null,repeat:D=0,debounce:J=null,errorAlert:F=!0,...W}={...(null==(s=null==window?void 0:window.grab)?void 0:s.defaults)||(null==(u=null==global?void 0:global.grab)?void 0:u.defaults)||{},...o};try{if(D>1){for(let e=0;e<D;e++)await r(t,{...o,repeat:0});return m}if(R)return setInterval((async()=>{await r(t,{...o,repeat:0,repeatEvery:null})}),1e3*R),m;if(null==o?void 0:o.setDefaults)return"undefined"!=typeof window?window.grab.defaults={...o,setDefaults:void 0}:global.grab.defaults={...o,setDefaults:void 0},{};let n="function"==typeof m?m:null;m&&!n||(m={});let i=JSON.stringify(j?{...W,[j]:void 0}:W),a=null==(d=r.log)?void 0:d.find((e=>e.request==i&&e.path==t));if(j){let e=(null==a?void 0:a.currentPage)+1||(null==W?void 0:W[j])||1;a||(m[T]=[],e=1),a&&(a.currentPage=e),W[j]=e}else{if(w&&a){for(let e of Object.keys(a.res))m[e]=a.res[e];return n&&(m=n(m)),m}for(let e of Object.keys(m))m[e]=void 0}if(m.isLoading=!0,n&&(m=n(m)),E>0&&(null==a?void 0:a.lastFetchTime)&&a.lastFetchTime>Date.now()-1e3*E)throw new Error("Fetch rate limit exceeded for "+t+". Wait "+E+"s between requests.");if(null==a?void 0:a.controller)if(A)a.controller.abort();else if(S)return{isLoading:!0};r.log.unshift({path:t,request:i,lastFetchTime:Date.now(),controller:new AbortController});let s={method:h,headers:{"Content-Type":"application/json",Accept:"application/json",...b},redirect:"follow",cache:w?"force-cache":"no-store",signal:A?null==(f=null==(c=r.log[0])?void 0:c.controller)?void 0:f.signal:AbortSignal.timeout(1e3*v)},u="";["POST","PUT","PATCH"].includes(h)?s.body=W.body||JSON.stringify(W):u="?"+new URLSearchParams(W).toString(),"function"==typeof beforeRequest&&([t,m,W,s]=L(t,m,W,s)),t.startsWith("/")||x.endsWith("/")||(t="/"+t),(t.startsWith("http:")||t.startsWith("https:"))&&(x="");let y=null,P=new Date,k=null==(g=r.mock)?void 0:g[t],N=e=>new Promise((t=>setTimeout(t,1e3*e||0)));if(!k||k.params&&k.method!=h||k.params&&i!=JSON.stringify(k.params)){y=await fetch(x+t+u,s).catch((e=>{throw new Error(e)}));let e=y.headers.get("content-type");y=await(e?e.includes("application/json")?y.json():e.includes("application/pdf")||e.includes("application/octet-stream")?y.blob():y.text():y.json()).catch((e=>{throw new Error("Error parsing response: "+e)})),(null==y?void 0:y.startsWith)&&(null==y?void 0:y.startsWith("{"))&&(y=JSON.parse(y))}else await N(k.delay),y="function"==typeof k.response?k.response(W):k.response;"function"==typeof afterRequest&&([t,m,W,s]=q(t,m,W,s)),delete m.isLoading,null==a||delete a.controller;const J=((Number(new Date)-Number(P))/1e3).toFixed(1);if(O&&(e("Path:"+x+t+u+"\n"+JSON.stringify(o,null,2)+"\nTime: "+J+"s\nResponse: "+l(y)),console.log(y)),void 0===y)return;for(let e of Object.keys(y))m[e]=T==e&&(null==(p=m[e])?void 0:p.length)?[...m[e],...y[e]]:y[e];return r.log.unshift({path:t,request:JSON.stringify({...W,paginateKey:void 0}),response:m,lastFetchTime:Date.now()}),n&&(m=n(m)),m}catch(C){let n="Error: "+C.message+"\nPath:"+x+t+JSON.stringify(W);return function(e){let t,o=document.getElementById("alert-overlay");o||(o=document.body.appendChild(document.createElement("div")),o.id="alert-overlay",o.style="position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center",o.innerHTML='<div id="alert-box" style="background:#fff;padding:1.5em 2em;border-radius:8px;box-shadow:0 2px 16px #0003;min-width:220px;max-width:90vw;max-height:80vh;position:relative;display:flex;flex-direction:column;">\n      <button id="close-alert" style="position:absolute;top:12px;right:20px;font-size:1.5em;background:none;border:none;cursor:pointer;color:black;">&times;</button>\n      <div id="alert-list" style="overflow:auto;flex:1;"></div>\n    </div>',o.addEventListener("click",(e=>{e.target===o&&o.remove()})),o.querySelector("#close-alert").onclick=()=>o.remove()),t=o.querySelector("#alert-list"),t.innerHTML+=`<div style="color:#c00;margin:0.5em 0;">${e}</div>`}(n),e(n,!0,"color: red;"),o.retryAttempts>0?await r(t,m,--o.retryAttempts):(C.message.includes("signal")||(m.error=C.message),delete m.isLoading,null==(y=r.log)||y.unshift({path:t,request:JSON.stringify(W),error:C.message}),resFunction&&(m=resFunction(m)),m)}}r.instance=(e={})=>(t,o={})=>r(t,{...e,...o}),"undefined"!=typeof window?(window.grab=r,window.log=e,window.grab.log=[],window.grab.mock={},window.grab.defaults={}):"undefined"!=typeof global&&(global.grab=r,global.log=e,global.grab.log=[],global.grab.mock={},global.grab.defaults={}),exports.default=r,exports.grab=r;
//# sourceMappingURL=grab-api.cjs.js.map
