"use strict";function e(e,t=void 0,o="color: blue; font-size: 14px;"){void 0===t&&(t=null==window?void 0:window.location.hostname.includes("localhost")),"object"==typeof e&&(e=l(e)+"\n\n"+JSON.stringify(e,null,2)),t?console.debug((o?"%c":"")+e,o):console.log((o?"%c":"")+e,o)}Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t={reset:"[0m",yellow:"[33m",cyan:"[36m",magenta:"[35m",gray:"[90m",green:"[32m",blue:"[34m",red:"[31m",white:"[37m"};function o(e){return"string"==typeof e?t.yellow:"number"==typeof e?t.cyan:"boolean"==typeof e?t.magenta:"function"==typeof e?t.red:null===e?t.gray:Array.isArray(e)?t.blue:"object"==typeof e?t.green:t.white}function n(e){return"string"==typeof e?'""':"number"==typeof e?"number":"boolean"==typeof e?"bool":"function"==typeof e?"function":null===e?"null":Array.isArray(e)?e.length?"["+n(e[0])+"]":"[]":"object"==typeof e?"{...}":typeof e}function l(e,r=0){const i="  ".repeat(r);if("object"!=typeof e||null===e){return o(e)+n(e)+t.reset}if(Array.isArray(e)){let o=t.blue+"["+t.reset;return e.length&&(o+="\n"),e.forEach(((t,n)=>{o+=i+"  "+l(t,r+1),n<e.length-1&&(o+=","),o+="\n"})),o+=i+t.blue+"]"+t.reset,o}let a=t.green+"{"+t.reset;const s=Object.keys(e);return s.length&&(a+="\n"),s.forEach(((u,c)=>{const d=e[u],f=o(d);a+=i+"  ","object"!=typeof d||null===d||Array.isArray(d)?Array.isArray(d)?a+=f+u+t.reset+": "+l(d,r+1):a+=f+u+": "+n(d)+t.reset:a+=f+u+t.reset+": "+l(d,r+1),c<s.length-1&&(a+=","),a+="\n"})),a+=i+t.green+"}"+t.reset,0===r&&console.log(a),a}async function r(t,o={}){var n,i,a,s,u,c,d,f,g,p,y;let{headers:b,response:m={},method:w="GET",cache:h=!1,timeout:v=20,baseURL:A="undefined"!=typeof process&&(null==(n=null==process?void 0:process.env)?void 0:n.SERVER_API_URL)||"/api/",cancelOngoingIfNew:O=!0,cancelNewIfOngoing:S=!1,rateLimit:j=0,debug:N=(null==(a=null==(i=null==window?void 0:window.location)?void 0:i.hostname)?void 0:a.includes("localhost")),paginateResult:T=null,paginateKey:P=null,setDefaults:R=!1,retryAttempts:E=0,logger:q=e,onBeforeRequest:D=null,...J}={...(null==(s=null==window?void 0:window.grab)?void 0:s.defaults)||(null==(u=null==global?void 0:global.grab)?void 0:u.defaults)||{},...o};try{if(null==o?void 0:o.setDefaults)return"undefined"!=typeof window?window.grab.default={...o,setDefaults:void 0}:global.grab.default={...o,setDefaults:void 0},{};m||(m={});let n=JSON.stringify(P?{...J,[P]:void 0}:J),i=null==(c=r.log)?void 0:c.find((e=>e.request==n&&e.path==t));if(P){let e=(null==i?void 0:i.currentPage)+1||(null==J?void 0:J[P])||1;i||(m[T]=[],e=1),i&&(i.currentPage=e),J[P]=e}else{if(h&&i){for(let e of Object.keys(i.res))m[e]=i.res[e];return m}for(let e of Object.keys(m))m[e]=void 0}if(m.isLoading=!0,j>0&&(null==i?void 0:i.lastFetchTime)&&i.lastFetchTime>Date.now()-1e3*j)throw new Error("Fetch rate limit exceeded for "+t+". Wait "+j+"s between requests.");if(null==i?void 0:i.controller)if(O)i.controller.abort();else if(S)return{isLoading:!0};r.log.unshift({path:t,request:n,lastFetchTime:Date.now(),controller:new AbortController});let a={method:w,headers:{"Content-Type":"application/json",Accept:"application/json",...b},redirect:"follow",cache:h?"force-cache":"no-store",signal:O?null==(f=null==(d=r.log[0])?void 0:d.controller)?void 0:f.signal:AbortSignal.timeout(1e3*v)},s="";["POST","PUT","PATCH"].includes(w)?a.body=JSON.stringify(J):s="?"+new URLSearchParams(J).toString(),"function"==typeof beforeRequest&&([t,m,J,a]=D(t,m,J,a)),t.startsWith("/")||A.endsWith("/")||(t="/"+t),(t.startsWith("http:")||t.startsWith("https:"))&&(A="");let u=null,y=new Date,R=null==(g=r.mock)?void 0:g[t];if(!R||R.params&&R.method!=w||R.params&&n!=JSON.stringify(R.params)){u=await fetch(A+t+s,a).catch((e=>{throw new Error(e)}));let e=u.headers.get("content-type");u=await(e?e.includes("application/json")?u.json():e.includes("application/pdf")||e.includes("application/octet-stream")?u.blob():u.text():u.json()).catch((e=>{throw new Error("Error parsing response: "+e)})),(null==u?void 0:u.startsWith)&&(null==u?void 0:u.startsWith("{"))&&(u=JSON.parse(u))}else await new Promise((e=>setTimeout(e,1e3*R.delay||0))),u="function"==typeof R.response?R.response(J):R.response;"function"==typeof afterRequest&&([t,m,J,a]=onAfterRequest(t,m,J,a)),delete m.isLoading,null==i||delete i.controller;const E=((Number(new Date)-Number(y))/1e3).toFixed(1);if(N&&(e("Path:"+A+t+s+"\n"+JSON.stringify(o,null,2)+"\nTime: "+E+"s\nResponse: "+l(u)),console.log(u)),void 0===u)return;for(let e of Object.keys(u))m[e]=T==e&&(null==(p=m[e])?void 0:p.length)?[...m[e],...u[e]]:u[e];return r.log.unshift({path:t,request:JSON.stringify({...J,paginateKey:void 0}),response:m,lastFetchTime:Date.now()}),m}catch(x){return e("Error: "+x.message+"\nPath:"+A+t+JSON.stringify(J),!0,"color: red;"),o.retryAttempts>0?await r(t,m,--o.retryAttempts):(x.message.includes("signal")||(m.error=x.message),delete m.isLoading,null==(y=r.log)||y.unshift({path:t,request:JSON.stringify(J),error:x.message}),m)}}l({name:"Alice",age:30,active:()=>!0,tags:["user",4,"admin"],profile:{email:"alice@example.com",verified:!1,meta:{created:"2024-01-01",score:99}}}),"undefined"!=typeof window?(window.grab=r,window.log=e,window.grab.log=[],window.grab.mock={},window.grab.default={}):"undefined"!=typeof global&&(global.grab=r,global.log=e,global.grab.log=[],global.grab.mock={},global.grab.default={}),exports.default=r,exports.grab=r;
//# sourceMappingURL=grab-api.cjs.js.map
